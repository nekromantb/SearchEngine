# SearchEngine
Search engine for skillbox course by BityukovDV

## Описание
Поисковый движок является выпускной работой по курсу Skillbox. 
  Поисковый движок корпоративного уровня предназначен для выдачи релевантных результатов по поисковым запросам из выборки документов.
Все параметры работы, пути к исходным фаилам, поисковыйе запросы задаются через слкжебные конфигурационные фаилы формата json.
## Конфигурационные фаилы
  Для работы необходимы следующие фаилы: 
  config.json в формате:
    '''json {
    "config": {
    "name": "SkillboxSearchEngine",
    "version": "0.1",
    "max_responses": 5
    },
    "files": [
    "../resources/file001.txt",
    "../resources/file002.txt",
    "../resources/file003.txt",
    "../resources/file004.txt",
    …
    ]
    }''' 
, где
    ● config — общая информация, без которой приложение не запускается. Если это
    поле отсутствует, то при старте программа должна выбросить исключение и
    вывести в текстовую консоль ошибку config file is empty. Если отсутствует сам
    файл config.json, то необходимо выбросить исключение и вывести ошибку config
    file is missing;
    ● name — поле с названием поискового движка. Оно может быть любым: вы
    можете придумать название для поискового движка самостоятельно.
    Информацию из данного поля необходимо отображать при старте приложения
    Starting;
    ● version — поле с номером версии поискового движка. Впоследствии можно
    сделать проверку. Если поле version не совпадает с версией самого
    приложения, то необходимо выдавать ошибку config.json has incorrect file
    version;
    ● max_responses — поле, определяющее максимальное количество ответов на
    один запрос.
    ● files содержит пути к файлам, по которым необходимо осуществлять поиск.
    Внутри списка files лежат пути к файлам;
    ● <путь к файлу>(“../resorces/file001.txt”) — это путь к файлу. Впоследствии по его
    содержимому необходимо совершить поиск. Если по этому пути файл не
    существует, то на экран выводится соответствующая ошибка, но выполнение
    программы не прекращается. При этом каждый документ содержит не более
    1000 слов с максимальной длиной каждого в 100 символов. Слова
    состоят из строчных латинских букв и разделены одним или несколькими
    пробелами;
  requests.json в формате:
    '''json {
    "requests": [
    "some words..",
    "some words..",
    "some words..",
    "some words..",
    …
    ]
    }'''
, где
    ● requests состоит из списка запросов, которые необходимо обработать
    поисковым движком. Поле содержит не более 1000 запросов, каждый из
    которых включает от одного до десяти слов;
    ● <содержимое запроса>(“some words”) — поисковый запрос, набор слов,
    разделённых одним или несколькими пробелами. По ним необходимо
    осуществить поиск. Все слова состоят из строчных латинских букв.
  Формат выходного фаилы answers.json будет выглядеть так:
    '''json {
    "answers": {
    "request001": {
    "result": "true",
    "relevance": {
    "docid": 0, “rank” : 0.989,
    "docid": 1, “rank” : 0.897,
    "docid": 2, “rank” : 0.750,
    "docid": 3, “rank” : 0.670,
    "docid": 4, “rank” : 0.561
    }
    },
    "request002": {
    "result": "true",
    "docid": 0, “rank” : 0.769
    },
    "request003": {
    "result": "false"
    }
    }
    }'''
, где
    ● answers — базовое поле в этом файле, которое содержит ответы на запросы;
    ● request001 … 003 — идентификатор запроса, по которому сформирован ответ.
    Идентификатор запроса формируется автоматически по порядку, в котором
    находятся запросы в поле requests файла requests.json. Например:
    "requests": [
    "some words..", для данной строки id запроса будет равен “request001”
    "some words..", для данной строки id запроса будет равен “request002”
    "some words..", для данной строки id запроса будет равен “request003”
    "some words..", для данной строки id запроса будет равен “request004”
    …
    ];
    ● result – результат поиска запроса. Если он принимает значение true, значит по
    данному запросу найден хотя бы один документ. Если результат имеет значение
    false, значит ни одного документа не найдено. Тогда других полей в ответе на
    этот запрос нет;
    ● relevance включается в файл answers.json, если на этот запрос удалось найти
    более одного документа;
    ● <Идентификатор документа>("docid") — идентификатор документа, в котором
    найден ответ на запрос. Он формируется автоматически при индексации всех
    документов исходя из порядка, в котором документы расположены в поле files в
    файле config.json. Например, если в поле config.json поле files содержит:
    "files": [
    "../resources/file001.txt", для данного файла docid будет равен 0
    "../resources/file002.txt", для данного файла docid будет равен 1
    "../resources/file003.txt", для данного файла docid будет равен 2
    "../resources/file004.txt", для данного файла docid будет равен 3
    …
    ];
    ● <ранг ответа>(“rank”) — ранг или поисковый рейтинг. Это число показывает,
    насколько документ подходит для заданного запроса. В ответе id документов
    располагаются в порядке уменьшения поискового рейтинга.
  Изначальные пути фаилов предполагают их наличие в корневой папке проекта.
  В случае их отсутствия будет выброшено исключение и пользователю в консоли будет предложено несколько вариантов запуска программы:
    ● при вводе "c" программа предложит изменить путь к фаилы после чего попробует прочитать фаил по новому пути;
    ● при вводе "r" программа попробует снова прочитать конфигурационный фаил. Предполагается что пользователь изменил/создвл конфигурационный фаил по дефолтному пути;
    ● при вводе "e" произойдет досрочное завершение программы ("force quet").
## Требования проекта
  Для работы проект требует подключения библиотеки nlohmann_json https://github.com/nlohmann/json
  Установите библиотеку путем скачивания папки с библиотекой в корень проекта. Переименуйте папку с библиотекой в nlohmann_json. Других настроек не требуется.
## Дополнительные возможности
  Проект имеет в составе возможность тестирования отдельных компонентов с помощью GoogleTest. Сами тесты включены в исполняемый фаил, все настройки проекта проведены.
  Для включения тестов закоментируйте в main.cpp блок кода int main(), после чего раскоментируйте блок кода, подписанный как GoogleTest.
Раскоментируйте строку "enable_testing()" в CMakeLists в корне проекта. 
  Для выключения google test проделайте обратные действия.
## Описание алгроитма поиска, используемого в программе
  После считывания фаилов программа индексирует входные ресурсные фаилы, описанные в фаиле config.json в поле files.
  Создается инвертированные индекс в виде словаря, в качестве ключей используются уникальные слова из текстов, данными является вектор структур, 
в которых описывается в каком документе сколько раз встречается уникальное слово, указанное в ключе.
  После создание инвертированного индекса программа больше не обращается к ресурсным фаилам.
  Обработка запросов происходит в следущем порядке:
    1) Запрос разбивается на слова, формируется список уникальных слов. Повторяющиеся слова в запросе игнорируются.
    2) К списку слов подключается по соответствию соответствующий инвертированный индекс, а так же подсчитывается общее количество встречи данного слова в документах.
В случае если слово не встречалось в документах, в дальнейшем поиске оно не участвует.
    3) Список уникальных слов для поиска сортируется в пордке возрастания встречаемости в документах (сначала редкие, потом частовстречаемые).
    4) По списку документов самого редкого слова ищется соответсвие для следующего по редкости слова. Отсеиваются все документы, не содержащие его.
    5) Пункт 4) повторяется для всех последующих слов списка. Если на выходе документы остаются- они выводятся в список документов к выдаче для данного запроса.
    6) Самое редкое слово исключается из списка для поиска. Повторяются действия по пунктам 4) и 5) для всех слов списка. 
В случае если на каком то этапе количество документов в списке на выдачу превысило масимальное количество документов на запрос, указанное в max_responses 
фаила config.json то поиск прекращается
    7) Для сформированного списка документов происходит расчет релевантности выдачи: Для этого для каждого документа рассчитывается абсолютная релевантность — 
сумма всех count всех найденных в документе слов из коллекции freq_dictionary, которая делится на максимальное значение абсолютной релевантности для всех
найденных.
    8) Список документов сортируется по убыванию релевантности. В случае одинаковой релевантности документы сортируются по возрастанию docid (cмотри описание выше)
    9) Список ограничивается по max_responses фаила config.json и передается на выдачу в answers.json.
    
    Контакты автора: почта: nekromantbit@gmail.com
